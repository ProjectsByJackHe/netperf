name: Custom Tasks

on:
  workflow_dispatch:

permissions: write-all

jobs:
  testjobA:
    runs-on: windows-latest
    steps:
      - name: Should succeed
        run: echo "This is attempt; ${{ github.run_attempt }}"
        shell: pwsh

  testjobB:
    needs: testjobA
    runs-on: windows-latest
    steps:
      - name: Checkout netperf
        uses: actions/checkout@v2
        with:
          ref: 'jackhe/statless-lab-runners'
          path: 'netperfrepo'
      - name: Wait...
        run: Start-Sleep -Seconds 100
        shell: pwsh
      - name: Run composite action
        uses: ./netperfrepo/.github/actions/stop-lab-machine
        with:
          master: '69'
          syncer_secret: ${{ secrets.SYNCER_SECRET }}
